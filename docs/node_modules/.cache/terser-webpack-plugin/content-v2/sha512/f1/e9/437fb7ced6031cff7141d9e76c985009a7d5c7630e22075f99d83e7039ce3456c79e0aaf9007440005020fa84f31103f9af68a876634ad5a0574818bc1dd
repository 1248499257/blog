{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{250:function(t,s,n){\"use strict\";n.r(s);var a=n(0),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"异步相关以及-event-loop\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#异步相关以及-event-loop\"}},[t._v(\"#\")]),t._v(\" 异步相关以及 Event Loop\")]),t._v(\" \"),n(\"h2\",{attrs:{id:\"异步编程\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#异步编程\"}},[t._v(\"#\")]),t._v(\" 异步编程\")]),t._v(\" \"),n(\"p\",[t._v(\"大家都知道，浏览器是\"),n(\"strong\",[t._v(\"多线程\")]),t._v(\"的但JS的执行环境是\"),n(\"strong\",[t._v(\"单线程\")]),t._v(\"的，既一次只能完成一件任务。如果有多个任务，那么后面的就必须排队。\")]),t._v(\" \"),n(\"p\",[t._v(\"这种模式的好处是实现起来比较简单，执行环境相对单纯；但坏处也很明显，就是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。\")]),t._v(\" \"),n(\"p\",[t._v(\"为了解决这个问题，JS 将任务的执行模式分成两种：\"),n(\"strong\",[t._v(\"同步\")]),t._v(\" 和 \"),n(\"strong\",[t._v(\"异步\")])]),t._v(\" \"),n(\"ul\",[n(\"li\",[n(\"p\",[n(\"strong\",[t._v(\"同步\")]),t._v(\"：任务是按照顺序依次处理的，当前这件事没有彻底做完，下一件事是执行不了的。\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[n(\"strong\",[t._v(\"异步\")]),t._v(\"：当前这件事没有彻底做完，需要等待一段时间才能继续处理，此时我们不等，继续执行下面的任务，当后面的任务完成后，在去把没有彻底完成的任务完成。\")])])]),t._v(\" \"),n(\"h2\",{attrs:{id:\"js中常见的异步编程\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#js中常见的异步编程\"}},[t._v(\"#\")]),t._v(\" JS中常见的异步编程\")]),t._v(\" \"),n(\"ol\",[n(\"li\",[n(\"p\",[t._v(\"所有的事件绑定都是异步编程  xxx.onclick = function(){};\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"所有的定时器都是异步编程\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"AJAX中一般都使用异步编程处理\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"回调函数也算是异步编程\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"Promise, async/await(这里暂时不提太多promise 和 async的相关知识，等接下来有空再手撕promise..)\")])])]),t._v(\" \"),n(\"h2\",{attrs:{id:\"浏览器是如何规划同步异步编程\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#浏览器是如何规划同步异步编程\"}},[t._v(\"#\")]),t._v(\" 浏览器是如何规划同步异步编程\")]),t._v(\" \"),n(\"ol\",[n(\"li\",[n(\"p\",[t._v(\"浏览器是多线程的，JS是单线程的（浏览器只给JS执行分配一个线程）：单线程的特点就是一次只能处理一件事情\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"JS在单线程中实现异步的机制，主要依赖于浏览器的\"),n(\"strong\",[t._v(\"任务队列\")]),t._v(\"完成的。浏览器中有两个任务队列（主任务队列jobs，等待任务队列task）\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"在jobs自上而下执行的时候，如果遇到一个异步操作任务，没有立即执行，而是把它放到task中排队\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"当jobs执行完成后才回到task中进行查找（jobs完不成，不管task中是否有到达执行事件的任务都不处理，因为JS一次只能处理一件事情）\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"task中谁优先达到处理条件了（这里下面会讲执行顺序），就把这个任务重新放到jobs中执行，执行完后，再去task中找\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"其实我们执行JS代码实际上就是往执行栈（一种后进先出的存储函数调用的栈结构）中放入函数\")])])]),t._v(\" \"),n(\"h2\",{attrs:{id:\"异步队列中的执行顺序\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#异步队列中的执行顺序\"}},[t._v(\"#\")]),t._v(\" 异步队列中的执行顺序\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-js extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[n(\"code\",[t._v(\"console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'script start'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"async\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async1\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"await\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async2\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'async1 end'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"async\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async2\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'async2 end'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"async1\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setTimeout\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'setTimeout'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Promise\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[t._v(\"resolve\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Promise'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'promise1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'promise2'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nconsole\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'script end'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// script start => async2 end => Promise => script end => promise1 => promise2 => async1 end => setTimeout\")]),t._v(\"\\n\")])])]),n(\"div\",{staticClass:\"custom-block warning\"},[n(\"p\",{staticClass:\"custom-block-title\"},[t._v(\"WARNING\")]),t._v(\" \"),n(\"p\",[t._v(\"新的浏览器中不是如上打印的，因为 await 变快了。\")])]),t._v(\" \"),n(\"p\",[t._v(\"首先肯定是同步任务先执行的，所以先输出 \"),n(\"strong\",[t._v(\"script start\")]),t._v(\"，接着遇到了 \"),n(\"strong\",[t._v(\"async1()\")]),t._v(\"，但是\"),n(\"strong\",[t._v(\"async1\")]),t._v(\"里面有 \"),n(\"strong\",[t._v(\"await async2()\"),n(\"strong\",[t._v(\"所以此时输出了 \"),n(\"strong\",[t._v(\"async2 end\")]),t._v(\"，接着函数返回了一个\")]),t._v(\"promise\")]),t._v(\"，往下走函数执行到了\"),n(\"strong\",[t._v(\"Promise\")]),t._v(\"这里，输出 \"),n(\"strong\",[t._v(\"promise\")]),t._v(\"。此时jobs队列执行完毕，接着查找task。那么又会回到 \"),n(\"strong\",[t._v(\"await\")]),t._v(\" 的位置执行返回的 \"),n(\"strong\",[t._v(\"Promise\")]),t._v(\" 的 \"),n(\"strong\",[t._v(\"resolve\")]),t._v(\" 函数，这又会把 \"),n(\"strong\",[t._v(\"resolve\")]),t._v(\" 丢到task中，接下来去执行 \"),n(\"strong\",[t._v(\"then\")]),t._v(\" 中的回调，当两个 \"),n(\"strong\",[t._v(\"then\")]),t._v(\" 中的回调全部执行完毕以后，又会回到 \"),n(\"strong\",[t._v(\"await\")]),t._v(\" 的位置处理返回值，这时候你可以看成是 \"),n(\"strong\",[t._v(\"Promise.resolve(返回值).then()\")]),t._v(\"，然后 \"),n(\"strong\",[t._v(\"await\")]),t._v(\" 后的代码全部被包裹进了 \"),n(\"strong\",[t._v(\"then\")]),t._v(\" 的回调中，所以 \"),n(\"strong\",[t._v(\"console.log('async1 end')\")]),t._v(\" 会优先执行于 \"),n(\"strong\",[t._v(\"setTimeout\")]),t._v(\"。\")]),t._v(\" \"),n(\"p\",[t._v(\"这里肯定是会看的非常绕，那么下面我总结一下：\")]),t._v(\" \"),n(\"ol\",[n(\"li\",[n(\"p\",[t._v(\"首先执行同步代码，这属于宏任务\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"当执行完所有同步代码后，执行栈为空，查询是否有异步代码需要执行\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"执行所有微任务\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"当执行完所有微任务后，如有必要会渲染页面\")])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"然后开始下一轮 Event Loop，执行宏任务中的异步代码，也就是 setTimeout 中的回调函数\")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);","extractedComments":[]}